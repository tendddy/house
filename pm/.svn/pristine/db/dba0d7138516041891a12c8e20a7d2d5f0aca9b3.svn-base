package com.cninsure.payment.util;


import java.security.Security;
import java.util.HashMap;
import java.util.Map;

import javax.crypto.Cipher;
import javax.crypto.spec.SecretKeySpec;

import org.bouncycastle.jce.provider.BouncyCastleProvider;

import com.cninsure.core.tools.util.ValidateUtil;

public class AESUtil {

	/**
	 * 密钥算法
	 */
	private static final String ALGORITHM = "AES";
	/**
	 * 加解密算法/工作模式/填充方式
	 */
	private static final String ALGORITHM_MODE_PADDING = "AES/ECB/PKCS7Padding";
	
	
	private static final Map<String, SecretKeySpec> keys ;
	
	static {
		Security.addProvider(new BouncyCastleProvider());
		
		keys = new HashMap<String, SecretKeySpec>();
		
		SecretKeySpec key1 = new SecretKeySpec(MD5Util.MD5Encode(ValidateUtil.getConfigValue("wxGzh.mch_key"), "UTF-8").toLowerCase().getBytes(),
				ALGORITHM);
		SecretKeySpec key2 = new SecretKeySpec(MD5Util.MD5Encode(ValidateUtil.getConfigValue("wxApp.mch_key"), "UTF-8").toLowerCase().getBytes(),
				ALGORITHM);
		SecretKeySpec key3 = new SecretKeySpec(MD5Util.MD5Encode(ValidateUtil.getConfigValue("wxApp1.mch_key"), "UTF-8").toLowerCase().getBytes(),
				ALGORITHM);
		keys.put(ValidateUtil.getConfigValue("wxGzh.mch_id"), key1);
		keys.put(ValidateUtil.getConfigValue("wxApp.mch_id"), key2);
		keys.put(ValidateUtil.getConfigValue("wxApp1.mch_id"), key3);
		
	}

//	public static void initKey(String password) {
//		try {
//			KeyGenerator kgen = KeyGenerator.getInstance("AES");
//			kgen.init(256, new SecureRandom(password.getBytes()));
//			SecretKey secretKey = kgen.generateKey();
//			byte[] enCodeFormat = secretKey.getEncoded();
//			SecretKeySpec key = new SecretKeySpec(enCodeFormat, "AES");
//		}
//		catch (Exception e) {
//			e.printStackTrace();
//		}
//
//	}

	/**
	 * AES加密
	 * 
	 * @param data
	 * @return
	 * @throws Exception
	 */
	public static String encryptData(String mchId, String data) throws Exception {
		// 创建密码器
		Cipher cipher = Cipher.getInstance(ALGORITHM_MODE_PADDING, "BC");
		// 初始化
		cipher.init(Cipher.ENCRYPT_MODE, keys.get(mchId));
		return Base64Util.encode(cipher.doFinal(data.getBytes()));
	}

	/**
	 * AES解密
	 * 
	 * @param base64Data
	 * @return
	 * @throws Exception
	 */
	public static String decryptData(String mchId, String base64Data) throws Exception {
		// 创建密码器
		Cipher cipher = Cipher.getInstance(ALGORITHM_MODE_PADDING,"BC");
		// 初始化
		cipher.init(Cipher.DECRYPT_MODE, keys.get(mchId));
		return new String(cipher.doFinal(Base64Util.decode(base64Data)));
	}

	public static void main(String[] args) throws Exception {
		// System.out.println(encryptData("1234")); // 加密
		String A = "A0TYx3jPuE1qA2r7nRGjlFpM9ATG8qDHRW7y9Dew160o4aag99fDjGWtrSoeH7j5v0uPunj00s2JlxMwq0hVCD8QpZ1wg+7srSOIDb+vf3omN83ntJFDGRlRvwoaSbUfeM8INwK+A1D/n9UmrCt4E4K0Rb3CT6nhFCvtnahBMNA50RnHC8zkbGDQYkCmJjqGMNebkNxtVoFUDm/dneofCbVYyh9wryQzVKX/VZuio04viyJzj+PDvkj3inIr2oL6X33hS9Rlfvj87EDhL3fBgw/xqiGtrTDF+vj0DTGu0mNT1JjrBfxffn61CThVYhSuf8b/mFjLkIXo3uoIN0Wn81n/6NHP9nsZJs/SecLyLczb3O055lqdQKJyqH7ziun2v3X9UQ/zh4MjH6wcqd0nLahygATHVj6EqFxs8cG8mFt1qEi4/+Az1fgdMPPl+KMnd8/PHlCJAYixPbMhyIuJhDfeiPz4Kx0PnKRae+I11NnDxNwx34B7K3tENfb+OhNZAfTjkc1Z0T7yKq73g0WmreWBwVl1N8mYomePMDTwVX1BEXJ71P4Fwk5IuTq5pzJp9iEDEK1IkyKD5J/lb19aAg5ap6a7Sja3T3YMqszmv0UlQOFLGerfx5uhDUoPefoQ2lUOTlcR6PklUqHx9s85pY1cUd8pLqo6CS63qnJwgepMkdsiemdZ6vZYmKW8tJ43E/wRH3dgc3pbCXDlU+C7xmJXdcCSvaw4M0TzPs+h38Zpe0dgQ6nUXJ/Uf2rZ1l3YV2p/fXt6gJuoTkStsIFfau3xM8rswo/ESKCitdhIEMvJP0/Wd5/mNHkMhiQpONoRge2bx8lFbl6dE2zaa8BTHm8tU4HHy2n1ef3CSr0UpLYEANJjaVzQ0bZXbsLZVdvAD/GqIa2tMMX6+PQNMa7SYxVLqqOxtGiR2a2+npyduzYFWk+AjN+ag/e26ycqWQZdtJbEWIGpUyNA6CVIvMOiRRz3k9auwEIUfLgQmaSGE1sbmoeIAnQ6g0b1lKBH23Xk8vBrNdjgvPvSiAW4xuFV0OEAVR6pgE+gR8U1gRw9I4c=";
		A = "bvU7wp/2on2gTN9ZZVxHx0WwCrvbMD00JqNk0kTyyZ0ZgB0051+MN+m//GUhMX3+EZrknnyOAM6NYm6MT7WynRtyiL4gSiiJHDJn1C5HZFINRw5oucnMRd6AeloAjuyB9+W1MPwKPXKDBDnkmnKmnqGyvVQmdeCBncdx+bpWiwBa6CaWU0rqYt3IQdaQPd/PT9OsjbUSOK96RaA79fjWA44xvgHLHQI16Yk97RZr/JahpMwvZmvv6hVBUvxOIStnOS04nXZRw6ki8vRsO2gnivD0taFYCcEAODHdJ0yLpgVG54mHKbr2HyimO0TnS02BfzY5WuBRkCwZ9Fa9UFOPUujfN4F7yLALAO7oDKpURCPy1cq9dkSvYx5XJPlqGHf66mD+ojLapFZLOJL2bbTb7r3OvU47WCmXp6K9pSkbC3TIR2QOKQKtUS4Lu6Jd0QzHgliHldD3rRu1tI/j9vvyr4UBu4k8F612Ger1icN6MK1AyzDiwu0zI2igmGDZREbdKNZFJMc0GRLiek6qeXV1c0ve85m1OKsaapWquhjvM4XWcovYJAkLXbcxzluKEjiHtRaqkmn5RTR176lMhLSC1uGNEBeypPaEClOE9W91gOzEK6PNCQ/QD3liHnWic2pNlLI2OwazMO8PXuP/lxawU4N82gOQu9rLITMTQgDLrQQ/juHobEvtM98RdLrLA9TZ8caB/q2aQaPopuwTUKSRBVkjk96RNPFoWGnxxqiM6n6Zvix33JJ7XgfcFpvijLOtOkcrT5XaZ1Hjk3MFp3GHFmyts2gs+tugUTMvI3pKBiyteW2Olx64jVly84QXFN/hmb4sd9ySe14H3Bab4oyzrb357CugeOBEzA2z+87Q9e7elASG5SoJJH2FbYuLPkILqbiYNZoQEnNoiczDk6HVPDJPyw3glDGfbttA3+vElQsSsP1qaBUVvayUuTea18UoiALCpnpwZ5H+Ln8dgFrmp/2sq35mnq2yIDcu9jfX8qyzUdRV3rRQ9ZNdhLRdJ/k7hzEn5vHZ8+Yncrti29YCJXvYjlnvtX+vG0Nv+WAjkJdwmW+mzSc03MiwCs0vjbShq0HtklZ75a9DCvRHI8hhLoFmCWCxSIN7XVP8t4q22DY=";
		String B = AESUtil.decryptData("1269647101",A);
		System.out.println(B); // 解密
	}

}
