package com.cninsure.payment.service.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.annotation.Resource;

import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.cninsure.core.dao.BaseDao;
import com.cninsure.core.dao.impl.BaseServiceImpl;
import com.cninsure.payment.dao.PMAppplatformuserbankcardDao;
import com.cninsure.payment.entity.PMAppplatformuserbankcard;
import com.cninsure.payment.model.BaseModel;
import com.cninsure.payment.service.PMAppplatformuserbankcardService;
import com.common.PmInterfaceFilter;

@Service
@Transactional
public class PMAppplatformuserbankcardServiceImpl extends BaseServiceImpl<PMAppplatformuserbankcard,Long> implements
		PMAppplatformuserbankcardService {
	@Resource
	private PMAppplatformuserbankcardDao pmAppplatformuserbankcardDao;

	@Override
	protected BaseDao<PMAppplatformuserbankcard,Long> getBaseDao() {
		return pmAppplatformuserbankcardDao;
	}

	@Override
	@PmInterfaceFilter
	public BaseModel getBindCardResult(long appId, String appUserId,long bankCardID, String ID) {
		BaseModel result = new BaseModel();
		
		PMAppplatformuserbankcard model = new PMAppplatformuserbankcard();
		model.setAppPlatformId(appId);
		model.setBankcardId(bankCardID);
		model.setIdcard(ID);
		
		PMAppplatformuserbankcard resultModel = pmAppplatformuserbankcardDao.selectOne(model);
		if(resultModel!=null){
			result.setStatus("OK");
			result.setMessage("绑卡成功");
			return result;
		}else{
			//TODO 触发定时任务查询中金接口
		}
		result.setStatus("ERROR");
		result.setMessage("绑卡失败请重试");
		return result;
	}

	@Override
	public List<Map<String, Object>> queryUserBankCard(long appId, String appUserId)
	{
		Map<String,Object> map = new HashMap<String,Object>();
		map.put("appId", appId);
		map.put("appUserId", appUserId);
		return pmAppplatformuserbankcardDao.selectUserBankCard(map);
	}

}